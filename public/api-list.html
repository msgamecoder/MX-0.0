<!DOCTYPE html>
<html>
<head>
  <title>üß† MX API List</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem;
      background: #f7f7f7;
      color: #222;
      margin: 0;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }
    .category {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .endpoint {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
    }
    .desc {
      color: #555;
      margin-bottom: 0.75rem;
    }
    button {
      padding: 0.5rem 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #0056b3;
    }

    /* Fullscreen Viewer */
    #fullscreenViewer {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 1000;
    }
    #fullscreenViewer img {
      max-width: 90%;
      max-height: 70vh;
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    .fullscreen-buttons {
      display: flex;
      gap: 1rem;
    }
    .fullscreen-buttons button {
      font-size: 1rem;
    }
    .cancel-btn { background: crimson; }
    .retry-btn { background: orange; display: none; }
    .download-btn { background: green; }

  </style>
</head>
<body>
  <h1>üß† MX API Endpoint List</h1>
  <div id="apiList">Loading API endpoints...</div>

  <!-- Fullscreen Image Viewer -->
  <div id="fullscreenViewer">
    <img id="fullImage" src="">
    <div class="fullscreen-buttons">
      <button class="cancel-btn" onclick="closeViewer()">‚ùå Cancel</button>
      <button class="retry-btn" id="retryBtn" onclick="retryImage()">üîÅ Retry</button>
      <button class="download-btn" onclick="downloadImage()">‚¨áÔ∏è Download</button>
    </div>
  </div>

  <script>
    const apiListDiv = document.getElementById('apiList');
    const fullViewer = document.getElementById('fullscreenViewer');
    const fullImage = document.getElementById('fullImage');
    const retryBtn = document.getElementById('retryBtn');

    function closeViewer() {
      fullViewer.style.display = 'none';
      fullImage.src = '';
      retryBtn.style.display = 'none';
    }

    function retryImage() {
      const currentSrc = fullImage.src;
      fullImage.src = '';
      setTimeout(() => {
        fullImage.src = currentSrc;
      }, 300);
    }

    function downloadImage() {
      const link = document.createElement('a');
      link.href = fullImage.src;
      link.download = 'mx_api_image.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    async function fetchCategories(route, emoji, type) {
      try {
        const res = await fetch(`/${route}`);
        const data = await res.json();
        displayCategory(route, data.categories, emoji, type);
      } catch {
        const div = document.createElement('div');
        div.className = 'category';
        div.innerHTML = `<div class="endpoint">${emoji} /${route}</div><div class="desc">‚ö†Ô∏è Failed to load this category</div>`;
        apiListDiv.appendChild(div);
      }
    }

    function displayCategory(route, list, emoji, type) {
      const sortedList = list.sort((a, b) => a.localeCompare(b));
      sortedList.forEach(name => {
        const container = document.createElement('div');
        container.className = 'category';

        const endpoint = `/${route}/${name}`;
        const desc = getDescription(name, route);

        container.innerHTML = `
          <div class="endpoint">${emoji} ${endpoint}</div>
          <div class="desc">${desc}</div>
          <button onclick="fetchResult('${endpoint}', '${type}')">üîç Preview</button>
        `;

        apiListDiv.appendChild(container);
      });
    }

    async function fetchResult(endpoint, type) {
      try {
        const res = await fetch(endpoint);
        const data = await res.json();

        if (type === 'image' && data.imageUrl) {
          fullImage.onerror = () => {
            retryBtn.style.display = 'inline-block';
          };
          retryBtn.style.display = 'none';
          fullImage.src = data.imageUrl;
          fullViewer.style.display = 'flex';
        } else if (type === 'text' && data.content) {
          alert(`üß† ${data.content}`);
        } else {
          alert("‚ö†Ô∏è Invalid response format.");
        }
      } catch {
        alert("‚ö†Ô∏è Could not fetch preview.");
      }
    }

    function getDescription(name, route) {
      const descriptions = {
        hug: "Sends a random hug image.",
        kiss: "Random kissing animation.",
        meow: "Cute cat images!",
        neko: "Anime-style NSFW neko image.",
        joke: "Returns a random joke.",
        fact: "Interesting random fact.",
        dare: "Dare generator for games.",
        riddle: "Mind-bending riddles.",
        quote: "Random quote to inspire.",
        truth: "Truth questions for fun.",
        pickuplines: "Cringey or funny pick-up lines!",
      };
      return descriptions[name] || "Random content from this category.";
    }

    window.onload = () => {
      fetchCategories("jest", "üß™", "image");
      fetchCategories("nsfw", "üîû", "image");
      fetchCategories("fun", "üéâ", "text");
    };
  </script>
</body>
</html>
