<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üß† MX API List</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f0f0f0;
      padding: 2rem;
      color: #222;
    }

    h1 {
      text-align: center;
      font-size: 2.8rem;
      margin-bottom: 2rem;
    }

    .filters {
      text-align: center;
      margin-bottom: 2rem;
    }

    .filters button {
      font-size: 1.1rem;
      padding: 0.8rem 1.5rem;
      margin: 0.4rem;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .letter-group {
      margin-bottom: 2rem;
    }

    .letter-title {
      font-size: 1.6rem;
      font-weight: bold;
      margin: 1rem 0;
      border-bottom: 2px solid #ccc;
    }

    .category {
      background: white;
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .endpoint {
      font-size: 1.3rem;
      font-weight: bold;
    }

    .desc {
      color: #444;
      margin: 0.6rem 0 1rem 0;
    }

    button {
      padding: 0.9rem 1.6rem;
      font-size: 1.1rem;
      margin: 0.4rem 0.6rem 0 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .preview-btn { background: #1e88e5; color: white; }
    .download-btn { background: #43a047; color: white; }

    #fullscreenViewer {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      flex-direction: column;
    }

    #fullImage {
      max-width: 95vw;
      max-height: 85vh;
      border-radius: 12px;
      margin-bottom: 2rem;
    }

    .fullscreen-buttons button {
      padding: 1rem 2rem;
      font-size: 1.3rem;
    }

    .cancel-btn { background: crimson; color: white; }
    .retry-btn { background: orange; color: white; display: none; }
    .download-btn-viewer { background: #4caf50; color: white; }
    .next-btn { background: dodgerblue; color: white; }
  </style>
</head>
<body>

<h1>üß† MX API Endpoint List</h1>
<div class="filters">
  <button onclick="filterLetters('A', 'E')">A‚ÄìE</button>
  <button onclick="filterLetters('F', 'K')">F‚ÄìK</button>
  <button onclick="filterLetters('L', 'Q')">L‚ÄìQ</button>
  <button onclick="filterLetters('R', 'Z')">R‚ÄìZ</button>
  <button onclick="resetFilters()">üîÅ Reset</button>
</div>

<div id="apiList">Loading API endpoints...</div>

<!-- Fullscreen Viewer -->
<div id="fullscreenViewer">
  <img id="fullImage" src="">
  <div class="fullscreen-buttons">
    <button class="cancel-btn" onclick="closeViewer()">‚ùå Cancel</button>
    <button class="retry-btn" id="retryBtn" onclick="retryImage()">üîÅ Retry</button>
    <button class="next-btn" id="nextBtn" onclick="fetchNextImage()">‚û°Ô∏è Next</button>
    <button class="download-btn-viewer" onclick="downloadImage()">‚¨áÔ∏è Download</button>
  </div>
</div>

<script>
const apiListDiv = document.getElementById('apiList');
const fullViewer = document.getElementById('fullscreenViewer');
const fullImage = document.getElementById('fullImage');
const retryBtn = document.getElementById('retryBtn');
const nextBtn = document.getElementById('nextBtn');

let allCategories = {};
let currentEndpoint = '';

function closeViewer() {
  fullViewer.style.display = 'none';
  fullImage.src = '';
  retryBtn.style.display = 'none';
  currentEndpoint = '';
}

function retryImage() {
  const src = fullImage.src;
  fullImage.src = '';
  setTimeout(() => { fullImage.src = src; }, 300);
}

function downloadImage() {
  const link = document.createElement('a');
  link.href = fullImage.src;
  link.download = 'image.jpg';
  link.click();
}

function fetchNextImage() {
  if (!currentEndpoint) return;
  nextBtn.disabled = true;
  nextBtn.innerText = 'Loading...';
  fetchResult(currentEndpoint, 'image', true);
}

function downloadText(content) {
  const blob = new Blob([content], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'content.txt';
  link.click();
}

async function fetchCategories(route, emoji, type) {
  try {
    const res = await fetch(`/${route}`);
    const data = await res.json();
    displayCategory(route, data.categories, emoji, type);
  } catch {
    const div = document.createElement('div');
    div.className = 'category';
    div.innerHTML = `<div class="endpoint">${emoji} /${route}</div><div class="desc">‚ö†Ô∏è Failed to load this category</div>`;
    apiListDiv.appendChild(div);
  }
}

function displayCategory(route, list, emoji, type) {
  const grouped = {};

  list.forEach(name => {
    const letter = name[0].toUpperCase();
    if (!grouped[letter]) grouped[letter] = [];
    grouped[letter].push({ name, route, emoji, type });
  });

  allCategories = grouped;
  renderGroups(Object.keys(grouped));
}

function renderGroups(lettersToShow) {
  apiListDiv.innerHTML = '';

  const sorted = [...lettersToShow].sort();

  sorted.forEach(letter => {
    const group = document.createElement('div');
    group.className = 'letter-group';
    group.innerHTML = `<div class="letter-title">üî§ ${letter}</div>`;

    allCategories[letter].forEach(({ name, route, emoji, type }) => {
      const container = document.createElement('div');
      container.className = 'category';
      const endpoint = `/${route}/${name}`;
      const desc = getDescription(name, route);

      container.innerHTML = `
        <div class="endpoint">${emoji} ${endpoint}</div>
        <div class="desc">${desc}</div>
        <button class="preview-btn" onclick="fetchResult('${endpoint}', '${type}')">üîç Preview</button>
        <button class="download-btn" onclick="downloadDirect('${endpoint}', '${type}')">‚¨áÔ∏è Download</button>
      `;
      group.appendChild(container);
    });

    apiListDiv.appendChild(group);
  });
}

function filterLetters(start, end) {
  const letters = Object.keys(allCategories).filter(
    l => l >= start && l <= end
  );
  renderGroups(letters);
}

function resetFilters() {
  renderGroups(Object.keys(allCategories));
}

async function fetchResult(endpoint, type, isNext = false) {
  try {
    const res = await fetch(endpoint);
    const data = await res.json();
    retryBtn.style.display = 'none';
    currentEndpoint = endpoint;

    if (type === 'image' && data.imageUrl) {
      fullImage.src = data.imageUrl;
      fullViewer.style.display = 'flex';
    } else if (type === 'text' && data.content) {
      if (!isNext) alert(`üß† ${data.content}`);
      else downloadText(data.content);
    } else {
      alert("‚ö†Ô∏è Invalid data format.");
    }

    nextBtn.disabled = false;
    nextBtn.innerText = '‚û°Ô∏è Next';

  } catch {
    retryBtn.style.display = 'inline-block';
    alert("‚ö†Ô∏è Failed to preview content.");
    nextBtn.disabled = false;
    nextBtn.innerText = '‚û°Ô∏è Next';
  }
}

async function downloadDirect(endpoint, type) {
  try {
    const res = await fetch(endpoint);
    const data = await res.json();

    if (type === 'image' && data.imageUrl) {
      const link = document.createElement('a');
      link.href = data.imageUrl;
      link.download = 'api-image.jpg';
      link.click();
    } else if (type === 'text' && data.content) {
      downloadText(data.content);
    } else {
      alert("‚ö†Ô∏è Could not get data.");
    }
  } catch {
    alert("‚ö†Ô∏è Download failed.");
  }
}

function getDescription(name, type) {
  const descriptions = {
    hug: "Sends a random hug image.",
    kiss: "Random kissing animation.",
    meow: "Cute cat images!",
    neko: "Anime-style NSFW neko image.",
    joke: "Returns a random joke.",
    fact: "Interesting random fact.",
    dare: "Dare generator for games.",
    riddle: "Mind-bending riddles.",
    quote: "Random quote to inspire.",
    truth: "Truth questions for fun.",
    pickuplines: "Cringey or funny pick-up lines!",
  };
  return descriptions[name] || "Random content from this category.";
}

// Load all categories on page load
window.onload = () => {
  fetchCategories("jest", "üß™", "image");
  fetchCategories("nsfw", "üîû", "image");
  fetchCategories("fun", "üéâ", "text");
};
</script>
</body>
</html>
